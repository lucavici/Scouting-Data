<!DOCTYPE html>
<html lang="en">

<head>
    <title>5419 Scouting</title>
    <link rel="icon" href="logo.png">
    <!--<script src="Control.js">update();</script>-->
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
</head>

<body>

    <!--home page-->

    <div id="sidenav" class="sidenav">

        <a href="index.html"><img id="logo" src="logo.png" alt="logo"></a>
        <a href="index.html">Team Info</a>
        <a href="">Recent Matches</a>
        <a href="GeneralScatter.html">General Scatter</a>
        <a href="TeamList.html">Team List</a>
        <a href="">Match Predictions</a>

    </div>

    <div class="main">

        <div class="wrapper">
            <div class="search-input">
              <a href="" target="_blank" hidden></a>
              <input id="input" type="text" placeholder="Search Team">
              <div class="autocom-box" onclick="search()">
                <!-- list inserted from javascript -->
              </div>
              <div class="icon" onclick="search()"><i class="fas fa-search"></i></div>
            </div>
        </div>

        

        <div id="showhide">

            <div class="quickData">

                <p>hi</p>

            </div>

            <div class="slideshow-container">

                <div class="slideshow">
            
                    <div class="mySlides">
                        <h2 class="title">Teleoperated</h2><br>
                        <canvas id="teleopGraph" height="200px"></canvas>
                    </div>
                    
                    <div class="mySlides">
                        <h2 class="title">Autonomous</h2><br>
                        <canvas id="autoGraph" height="200px"></canvas>
                    </div>
                    
                    <div class="mySlides">
                        <h2 class="title">Traversal</h2><br>
                        <canvas id="traversalGraph" height="200px"></canvas>
                    </div>
                    
                    <a class="prev" onclick="plusSlides(-1)">❮</a>
                    <a class="next" onclick="plusSlides(1)">❯</a>
                
                </div>
                
                <div class="dot-container">
                    <span class="dot" onclick="currentSlide(1)"></span> 
                    <span class="dot" onclick="currentSlide(2)"></span> 
                    <span class="dot" onclick="currentSlide(3)"></span> 
                </div>

            </div>
            

            <br><br>
    
        </div>

    </div>

</body>


<script>

    // START MOVING GRAPH SLIDES STUFF

    var slideIndex = 1;
    showSlides(slideIndex);

    function plusSlides(n) {
        showSlides(slideIndex += n);
    }

    function currentSlide(n) {
        showSlides(slideIndex = n);
    }

    function showSlides(n) {
        var i;
        var slides = document.getElementsByClassName("mySlides");
        var dots = document.getElementsByClassName("dot");
        if (n > slides.length) {slideIndex = 1}    
        if (n < 1) {slideIndex = slides.length}
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";  
        }
        for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex-1].style.display = "block";  
        dots[slideIndex-1].className += " active";
    }

    // END MOVING GRAPH SLIDES STUFF

    // START SEARCHBOX STUFF

    var TeamData = null;

    const init = async () => {
        try {
            TeamData = await (await fetch("TestData.json")).json();
            //length = Object.keys(TeamData).length;
        } catch(e) {
            console.log(`Could not read file: ${e}`);
        }
    }

    function search() {
        const input = document.getElementById("input");
    
        document.getElementById("showhide").style.visibility = "visible";
        
    }

    let suggestions = [];

    init().then(() => {

        if (TeamData != null) {

            console.log(TeamData);

            var listItems = '<option selected="selected" value="0">- Select -</option>';

            for (let i = 0; i < TeamData.length; i++) {
                listItems += "<option value='" + TeamData[i].number + "'>" + TeamData[i].number + "</option>";
                suggestions.push(TeamData[i].number);
            }

            $("#teamselect").html(listItems);

            // getting all required elements
            const searchWrapper = document.querySelector(".search-input");
            const inputBox = searchWrapper.querySelector("input");
            const suggBox = searchWrapper.querySelector(".autocom-box");
            const icon = searchWrapper.querySelector(".icon");
            
            // getting the input field
            var input = document.getElementById("input");

            var selectedTeam = input;

            // if user presses any key and releases
            inputBox.onkeyup = (e)=>{
                let userData = e.target.value; // what the user entered
                let emptyArray = []; 

                if (userData){
                    // execute a function when the user presses a key on the keyboard
                    input.addEventListener("keypress", function(event) {
                        // if the user presses the enter key
                        if (event.key === "Enter") {
                            suggestions.emptyArray();
                            searchWrapper.querySelector("input") = "";
                            console.log("maybe here?");
                            search();
                        }
                    });

                    icon.onclick = ()=> {
                        suggestions.emptyArray();
                        console.log("here");
                        search();
                    }

                    emptyArray = suggestions.filter((data)=>{
                        //filtering array value and user characters to lowercase and return only those words which are start with user enetered nums
                        return data.toLocaleLowerCase().startsWith(userData.toLocaleLowerCase());
                    });

                    emptyArray = emptyArray.map((data)=>{
                        // passing return data inside li tag
                        return data = `<li>${data}</li>`;
                    });
                    
                    searchWrapper.classList.add("active"); //show autocomplete box
                    showSuggestions(emptyArray);
                    let allList = suggBox.querySelectorAll("li");
                    
                    for (let i = 0; i < allList.length; i++) {
                        //adding onclick attribute in all li tags
                        allList[i].setAttribute("onclick", "");
                    }
                } else {
                    searchWrapper.classList.remove("active"); //hide autocomplete box
                }
            }

            function showSuggestions(list){
                let listData;
                if (!list.length){
                    userValue = inputBox.value;
                    listData = `<li>${userValue}</li>`;
                } else {
                    listData = list.join('');
                }
                suggBox.innerHTML = listData;
            }

            // END SEARCHBOX STUFF

            // START QUICK DATA DISPLAY STUFF

            //END QUICK DATA DISPLAY STUFF

            // START GRAPH DISPLAY STUFF

            var selectedTeam = "5419";

            let autoHighSuccess = {};
            let autoLowSuccess = {};
            let autoFail = {};

            let teleHighSuccess = {};
            let teleLowSuccess = {};
            let teleFail = {};

            let climbAttempted = {};
            let climbActual = {};

            for (var i = 0; i < TeamData.length; i++) {
                if (TeamData[i].number == selectedTeam) {
                    for (var j = 0; j < TeamData[i].matches.length; j++) {
                        autoHighSuccess[TeamData[i].matches[j].number] = TeamData[i].matches[j].aHigh;
                        autoLowSuccess[TeamData[i].matches[j].number] = TeamData[i].matches[j].aLow;
                        autoFail[TeamData[i].matches[j].number] = TeamData[i].matches[j].aFail;
                        teleHighSuccess[TeamData[i].matches[j].number] = TeamData[i].matches[j].tHigh;
                        teleLowSuccess[TeamData[i].matches[j].number] = TeamData[i].matches[j].tLow;
                        teleFail[TeamData[i].matches[j].number] = TeamData[i].matches[j].tFail;
                        climbAttempted[TeamData[i].matches[j].number] = TeamData[i].matches[j].climbAttempted;
                        climbActual[TeamData[i].matches[j].number] = TeamData[i].matches[j].climbActual;
                    }
                } 
            }

            console.log(autoHighSuccess);

            backgroundColors = ['rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'];

            borderColors = [ 'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
            ];

            const teleop = {
                
                labels: Object.keys(teleHighSuccess),
                datasets: [
                {
                    label: 'Teleop High',
                    data: Object.values(teleHighSuccess),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                },
                {
                    label: 'Teleop Low',
                    data: Object.values(teleLowSuccess),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                },
                {
                    label: 'Teleop Fail',
                    data: Object.values(teleFail),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                }
                    
            ]};

            const auto = {
                
                labels: Object.keys(autoHighSuccess),
                datasets: [
                {
                    label: 'Auto High',
                    data: Object.values(autoHighSuccess),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                },
                {
                    label: 'Auto Low',
                    data: Object.values(autoLowSuccess),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                },
                {
                    label: 'Auto Fail',
                    data: Object.values(autoFail),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                }
                    
            ]};

            const traversal = {
                
                labels: Object.keys(autoHighSuccess),
                datasets: [
                {
                    label: 'Auto High',
                    data: Object.values(autoHighSuccess),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                },
                {
                    label: 'Auto Low',
                    data: Object.values(autoLowSuccess),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                },
                {
                    label: 'Auto Fail',
                    data: Object.values(autoFail),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                }
                    
            ]};

            
            const ctx1 = document.getElementById('teleopGraph').getContext('2d');
            const teleopGraph = new Chart(ctx1, {
                type: 'line',
                data: teleop,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                },
            });

            const ctx2 = document.getElementById('autoGraph').getContext('2d');
            const autoGraph = new Chart(ctx2, {
                type: 'line',
                data: auto,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                },
            });

            const ctx3 = document.getElementById('traversalGraph').getContext('2d');
            const traversalGraph = new Chart(ctx3, {
                type: 'line',
                data: traversal,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                },
            });
            
        }

        //END GRAPH DISPLAY STUFF

                
    });

</script>

</html>
